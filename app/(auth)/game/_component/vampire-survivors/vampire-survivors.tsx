// "use client";
//
// import React, { useState, useEffect, useCallback, useRef } from "react";
// import {
//   Skull,
//   Zap,
//   Shield,
//   Target,
//   Heart,
//   Star,
//   Swords,
//   Crown,
// } from "lucide-react";
//
// const GAME_WIDTH = 800;
// const GAME_HEIGHT = 600;
// const PLAYER_SIZE = 20;
// const ENEMY_SIZE = 16;
// const XP_ORB_SIZE = 8;
// const WEAPON_DAMAGE = 25;
// const WEAPON_COOLDOWN = 1000;
//
// // Ï∫êÎ¶≠ÌÑ∞ Îç∞Ïù¥ÌÑ∞
// const characters = [
//   {
//     id: "warrior",
//     name: "Ï†ÑÏÇ¨",
//     icon: Swords,
//     stats: { hp: 120, speed: 2, damage: 1.2, armor: 1.1 },
//     color: "#ff6b6b",
//   },
//   {
//     id: "mage",
//     name: "ÎßàÎ≤ïÏÇ¨",
//     icon: Zap,
//     stats: { hp: 80, speed: 2.2, damage: 1.5, armor: 0.9 },
//     color: "#4ecdc4",
//   },
//   {
//     id: "archer",
//     name: "Í∂ÅÏàò",
//     icon: Target,
//     stats: { hp: 100, speed: 2.5, damage: 1.3, armor: 1.0 },
//     color: "#95e1d3",
//   },
// ];
//
// // Î¨¥Í∏∞ Îç∞Ïù¥ÌÑ∞
// const weapons = [
//   {
//     id: "fireball",
//     name: "ÌååÏù¥Ïñ¥Î≥º",
//     icon: "üî•",
//     damage: 30,
//     cooldown: 800,
//     range: 150,
//     evolution: {
//       id: "meteor",
//       name: "Î©îÌÖåÏò§",
//       damage: 80,
//       cooldown: 600,
//       range: 200,
//     },
//   },
//   {
//     id: "lightning",
//     name: "Î≤àÍ∞ú",
//     icon: "‚ö°",
//     damage: 45,
//     cooldown: 1200,
//     range: 120,
//     evolution: {
//       id: "storm",
//       name: "Ìè≠Ìíç",
//       damage: 90,
//       cooldown: 1000,
//       range: 180,
//     },
//   },
//   {
//     id: "ice",
//     name: "ÏñºÏùåÏ∞Ω",
//     icon: "‚ùÑÔ∏è",
//     damage: 25,
//     cooldown: 600,
//     range: 100,
//     evolution: {
//       id: "blizzard",
//       name: "Î∏îÎ¶¨ÏûêÎìú",
//       damage: 60,
//       cooldown: 500,
//       range: 160,
//     },
//   },
//   {
//     id: "holy",
//     name: "ÏÑ±Ïä§Îü¨Ïö¥ Îπõ",
//     icon: "‚ú®",
//     damage: 35,
//     cooldown: 1000,
//     range: 140,
//     evolution: {
//       id: "divine",
//       name: "Ïã†ÏÑ±Ìïú Ïã¨Ìåê",
//       damage: 100,
//       cooldown: 800,
//       range: 220,
//     },
//   },
// ];
//
// // Ìå®ÏãúÎ∏å ÏïÑÏù¥ÌÖú
// const passives = [
//   { id: "speed", name: "ÏÜçÎèÑ Ï¶ùÍ∞Ä", icon: "üí®", effect: "speed", value: 0.3 },
//   {
//     id: "damage",
//     name: "Í≥µÍ≤©Î†• Ï¶ùÍ∞Ä",
//     icon: "üí™",
//     effect: "damage",
//     value: 0.2,
//   },
//   { id: "health", name: "Ï≤¥Î†• Ï¶ùÍ∞Ä", icon: "‚ù§Ô∏è", effect: "maxHp", value: 20 },
//   {
//     id: "cooldown",
//     name: "Ïø®Îã§Ïö¥ Í∞êÏÜå",
//     icon: "‚è∞",
//     effect: "cooldown",
//     value: 0.15,
//   },
// ];
//
// export default function VampireSurvivorsGame() {
//   const canvasRef = useRef(null);
//   const gameLoopRef = useRef(null);
//   const [gameState, setGameState] = useState("character-select"); // character-select, playing, paused, levelup, gameover
//   const [selectedCharacter, setSelectedCharacter] = useState(null);
//   const [gameTime, setGameTime] = useState(0);
//   const [score, setScore] = useState(0);
//
//   // Í≤åÏûÑ Í∞ùÏ≤¥Îì§
//   const [player, setPlayer] = useState({
//     x: GAME_WIDTH / 2,
//     y: GAME_HEIGHT / 2,
//     hp: 100,
//     maxHp: 100,
//     xp: 0,
//     level: 1,
//     xpToNext: 100,
//     weapons: [],
//     passives: [],
//     stats: { speed: 2, damage: 1, armor: 1, maxHp: 100, cooldown: 1 },
//   });
//
//   const [enemies, setEnemies] = useState([]);
//   const [projectiles, setProjectiles] = useState([]);
//   const [xpOrbs, setXpOrbs] = useState([]);
//   const [levelUpOptions, setLevelUpOptions] = useState([]);
//   const [keys, setKeys] = useState({});
//   const [mouse, setMouse] = useState({ x: 0, y: 0 });
//
//   // ÌÇ§Î≥¥Îìú ÏûÖÎ†• Ï≤òÎ¶¨
//   useEffect(() => {
//     const handleKeyDown = (e) => {
//       setKeys((prev) => ({ ...prev, [e.key]: true }));
//       if (e.key === " " && gameState === "playing") {
//         setGameState("paused");
//       } else if (e.key === " " && gameState === "paused") {
//         setGameState("playing");
//       }
//     };
//
//     const handleKeyUp = (e) => {
//       setKeys((prev) => ({ ...prev, [e.key]: false }));
//     };
//
//     window.addEventListener("keydown", handleKeyDown);
//     window.addEventListener("keyup", handleKeyUp);
//
//     return () => {
//       window.removeEventListener("keydown", handleKeyDown);
//       window.removeEventListener("keyup", handleKeyUp);
//     };
//   }, [gameState]);
//
//   // ÎßàÏö∞Ïä§ ÏûÖÎ†• Ï≤òÎ¶¨
//   useEffect(() => {
//     const handleMouseMove = (e) => {
//       const canvas = canvasRef.current;
//       if (canvas) {
//         const rect = canvas.getBoundingClientRect();
//         setMouse({
//           x: e.clientX - rect.left,
//           y: e.clientY - rect.top,
//         });
//       }
//     };
//
//     window.addEventListener("mousemove", handleMouseMove);
//     return () => window.removeEventListener("mousemove", handleMouseMove);
//   }, []);
//
//   // Ï∫êÎ¶≠ÌÑ∞ ÏÑ†ÌÉù
//   const selectCharacter = (character) => {
//     setSelectedCharacter(character);
//     setPlayer((prev) => ({
//       ...prev,
//       maxHp: character.stats.hp,
//       hp: character.stats.hp,
//       stats: { ...prev.stats, ...character.stats },
//       weapons: [
//         {
//           ...weapons[0], // Í∏∞Î≥∏ Î¨¥Í∏∞ ÌååÏù¥Ïñ¥Î≥º
//           level: 1,
//           lastFired: 0,
//         },
//       ],
//     }));
//     setGameState("playing");
//   };
//
//   // Î†àÎ≤®ÏóÖ ÏòµÏÖò ÏÉùÏÑ±
//   const generateLevelUpOptions = useCallback(() => {
//     const options = [];
//     const availableWeapons = weapons.filter(
//       (w) =>
//         !player.weapons.some(
//           (pw) => pw.id === w.id || pw.id === w.evolution?.id,
//         ),
//     );
//     const availablePassives = passives.filter(
//       (p) =>
//         !player.passives.some((pp) => pp.id === p.id) ||
//         player.passives.find((pp) => pp.id === p.id)?.level < 5,
//     );
//
//     // Î¨¥Í∏∞ ÏßÑÌôî ÏòµÏÖò
//     player.weapons.forEach((weapon) => {
//       const baseWeapon = weapons.find((w) => w.id === weapon.id);
//       if (
//         baseWeapon?.evolution &&
//         weapon.level >= 3 &&
//         !player.weapons.some((w) => w.id === baseWeapon.evolution.id)
//       ) {
//         options.push({
//           type: "evolution",
//           weapon: baseWeapon.evolution,
//           baseWeapon: weapon,
//         });
//       }
//     });
//
//     // ÏÉà Î¨¥Í∏∞
//     if (availableWeapons.length > 0 && player.weapons.length < 6) {
//       options.push({
//         type: "weapon",
//         weapon:
//           availableWeapons[Math.floor(Math.random() * availableWeapons.length)],
//       });
//     }
//
//     // Î¨¥Í∏∞ Í∞ïÌôî
//     if (player.weapons.length > 0) {
//       const upgradeableWeapons = player.weapons.filter((w) => w.level < 5);
//       if (upgradeableWeapons.length > 0) {
//         options.push({
//           type: "upgrade",
//           weapon:
//             upgradeableWeapons[
//               Math.floor(Math.random() * upgradeableWeapons.length)
//             ],
//         });
//       }
//     }
//
//     // Ìå®ÏãúÎ∏å ÏïÑÏù¥ÌÖú
//     if (availablePassives.length > 0) {
//       options.push({
//         type: "passive",
//         passive:
//           availablePassives[
//             Math.floor(Math.random() * availablePassives.length)
//           ],
//       });
//     }
//
//     // 3Í∞ú ÏòµÏÖò ÏÑ†ÌÉù
//     const finalOptions = [];
//     while (finalOptions.length < 3 && options.length > 0) {
//       const randomIndex = Math.floor(Math.random() * options.length);
//       finalOptions.push(options.splice(randomIndex, 1)[0]);
//     }
//
//     return finalOptions;
//   }, [player.weapons, player.passives]);
//
//   // Î†àÎ≤®ÏóÖ ÏòµÏÖò ÏÑ†ÌÉù
//   const selectLevelUpOption = (option) => {
//     setPlayer((prev) => {
//       const newPlayer = { ...prev };
//
//       if (option.type === "weapon") {
//         newPlayer.weapons.push({
//           ...option.weapon,
//           level: 1,
//           lastFired: 0,
//         });
//       } else if (option.type === "upgrade") {
//         const weaponIndex = newPlayer.weapons.findIndex(
//           (w) => w.id === option.weapon.id,
//         );
//         if (weaponIndex !== -1) {
//           newPlayer.weapons[weaponIndex].level++;
//         }
//       } else if (option.type === "evolution") {
//         const baseIndex = newPlayer.weapons.findIndex(
//           (w) => w.id === option.baseWeapon.id,
//         );
//         if (baseIndex !== -1) {
//           newPlayer.weapons[baseIndex] = {
//             ...option.weapon,
//             level: 1,
//             lastFired: 0,
//           };
//         }
//       } else if (option.type === "passive") {
//         const existingIndex = newPlayer.passives.findIndex(
//           (p) => p.id === option.passive.id,
//         );
//         if (existingIndex !== -1) {
//           newPlayer.passives[existingIndex].level++;
//         } else {
//           newPlayer.passives.push({
//             ...option.passive,
//             level: 1,
//           });
//         }
//
//         // Ìå®ÏãúÎ∏å Ìö®Í≥º Ï†ÅÏö©
//         if (option.passive.effect === "maxHp") {
//           newPlayer.maxHp += option.passive.value;
//           newPlayer.hp += option.passive.value;
//         } else if (option.passive.effect in newPlayer.stats) {
//           newPlayer.stats[option.passive.effect] += option.passive.value;
//         }
//       }
//
//       return newPlayer;
//     });
//
//     setGameState("playing");
//   };
//
//   // Ï†Å Ïä§Ìè∞
//   const spawnEnemy = useCallback(() => {
//     const side = Math.floor(Math.random() * 4);
//     let x, y;
//
//     switch (side) {
//       case 0: // top
//         x = Math.random() * GAME_WIDTH;
//         y = -ENEMY_SIZE;
//         break;
//       case 1: // right
//         x = GAME_WIDTH + ENEMY_SIZE;
//         y = Math.random() * GAME_HEIGHT;
//         break;
//       case 2: // bottom
//         x = Math.random() * GAME_WIDTH;
//         y = GAME_HEIGHT + ENEMY_SIZE;
//         break;
//       case 3: // left
//         x = -ENEMY_SIZE;
//         y = Math.random() * GAME_HEIGHT;
//         break;
//       default:
//         x = 0;
//         y = 0;
//     }
//
//     const enemyTypes = [
//       { hp: 50, speed: 1, color: "#ff4757", xp: 5, icon: "üëπ" },
//       { hp: 30, speed: 1.5, color: "#ff6348", xp: 3, icon: "üßü" },
//       { hp: 80, speed: 0.8, color: "#8b0000", xp: 8, icon: "üíÄ" },
//     ];
//
//     const type = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
//
//     return {
//       id: Date.now() + Math.random(),
//       x,
//       y,
//       ...type,
//       maxHp: type.hp,
//     };
//   }, []);
//
//   // Î∞úÏÇ¨Ï≤¥ ÏÉùÏÑ±
//   const createProjectile = useCallback(
//     (weapon, targetX, targetY) => {
//       const dx = targetX - player.x;
//       const dy = targetY - player.y;
//       const distance = Math.sqrt(dx * dx + dy * dy);
//
//       if (distance > weapon.range) return null;
//
//       const speed = 5;
//
//       return {
//         id: Date.now() + Math.random(),
//         x: player.x,
//         y: player.y,
//         vx: (dx / distance) * speed,
//         vy: (dy / distance) * speed,
//         damage: weapon.damage * player.stats.damage,
//         weapon: weapon.id,
//         icon: weapon.icon,
//       };
//     },
//     [player.x, player.y, player.stats.damage],
//   );
//
//   // XP Ïò§Î∏å ÏÉùÏÑ±
//   const createXpOrb = useCallback((x, y, xp) => {
//     return {
//       id: Date.now() + Math.random(),
//       x: x + (Math.random() - 0.5) * 20,
//       y: y + (Math.random() - 0.5) * 20,
//       xp,
//       life: 300, // 5Ï¥à
//     };
//   }, []);
//
//   // Í≤åÏûÑ ÏóÖÎç∞Ïù¥Ìä∏
//   const updateGame = useCallback(() => {
//     if (gameState !== "playing") return;
//
//     const currentTime = Date.now();
//
//     setGameTime((prev) => prev + 1);
//
//     // ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Îèô
//     setPlayer((prev) => {
//       let newX = prev.x;
//       let newY = prev.y;
//
//       if (keys["ArrowLeft"] || keys["a"]) newX -= prev.stats.speed;
//       if (keys["ArrowRight"] || keys["d"]) newX += prev.stats.speed;
//       if (keys["ArrowUp"] || keys["w"]) newY -= prev.stats.speed;
//       if (keys["ArrowDown"] || keys["s"]) newY += prev.stats.speed;
//
//       // ÌôîÎ©¥ Í≤ΩÍ≥Ñ Ï†úÌïú
//       newX = Math.max(PLAYER_SIZE, Math.min(GAME_WIDTH - PLAYER_SIZE, newX));
//       newY = Math.max(PLAYER_SIZE, Math.min(GAME_HEIGHT - PLAYER_SIZE, newY));
//
//       return { ...prev, x: newX, y: newY };
//     });
//
//     // Ï†Å Ïä§Ìè∞
//     if (Math.random() < 0.02 + gameTime * 0.00001) {
//       setEnemies((prev) => [...prev, spawnEnemy()]);
//     }
//
//     // Ï†Å Ïù¥Îèô Î∞è Î¨¥Í∏∞ Î∞úÏÇ¨
//     setEnemies((prevEnemies) => {
//       const updatedEnemies = prevEnemies.map((enemy) => {
//         const dx = player.x - enemy.x;
//         const dy = player.y - enemy.y;
//         const distance = Math.sqrt(dx * dx + dy * dy);
//
//         return {
//           ...enemy,
//           x: enemy.x + (dx / distance) * enemy.speed,
//           y: enemy.y + (dy / distance) * enemy.speed,
//         };
//       });
//
//       // Î¨¥Í∏∞ Î∞úÏÇ¨ Î°úÏßÅÏùÑ Ïó¨Í∏∞ÏÑú Ïã§Ìñâ
//       setPlayer((prevPlayer) => {
//         const updatedWeapons = prevPlayer.weapons.map((weapon) => {
//           if (
//             currentTime - weapon.lastFired >=
//             weapon.cooldown / prevPlayer.stats.cooldown
//           ) {
//             // Í∞ÄÏû• Í∞ÄÍπåÏö¥ Ï†Å Ï∞æÍ∏∞
//             let closestEnemy = null;
//             let closestDistance = Infinity;
//
//             updatedEnemies.forEach((enemy) => {
//               const distance = Math.sqrt(
//                 (enemy.x - prevPlayer.x) ** 2 + (enemy.y - prevPlayer.y) ** 2,
//               );
//               if (distance < closestDistance && distance <= weapon.range) {
//                 closestDistance = distance;
//                 closestEnemy = enemy;
//               }
//             });
//
//             if (closestEnemy) {
//               const projectile = createProjectile(
//                 weapon,
//                 closestEnemy.x,
//                 closestEnemy.y,
//               );
//               if (projectile) {
//                 setProjectiles((prevProj) => [...prevProj, projectile]);
//               }
//
//               return { ...weapon, lastFired: currentTime };
//             }
//           }
//           return weapon;
//         });
//
//         return { ...prevPlayer, weapons: updatedWeapons };
//       });
//
//       return updatedEnemies;
//     });
//
//     // Î∞úÏÇ¨Ï≤¥ Ïù¥Îèô
//     setProjectiles((prev) =>
//       prev
//         .map((proj) => ({
//           ...proj,
//           x: proj.x + proj.vx,
//           y: proj.y + proj.vy,
//         }))
//         .filter(
//           (proj) =>
//             proj.x >= 0 &&
//             proj.x <= GAME_WIDTH &&
//             proj.y >= 0 &&
//             proj.y <= GAME_HEIGHT,
//         ),
//     );
//
//     // Ï∂©Îèå Í≤ÄÏÇ¨ - Î∞úÏÇ¨Ï≤¥ÏôÄ Ï†Å
//     setEnemies((prev) => {
//       const newEnemies = [];
//       const hitProjectiles = new Set();
//
//       prev.forEach((enemy) => {
//         let enemyHit = false;
//
//         projectiles.forEach((proj) => {
//           if (hitProjectiles.has(proj.id)) return;
//
//           const distance = Math.sqrt(
//             (proj.x - enemy.x) ** 2 + (proj.y - enemy.y) ** 2,
//           );
//
//           if (distance < ENEMY_SIZE) {
//             enemy.hp -= proj.damage;
//             hitProjectiles.add(proj.id);
//             enemyHit = true;
//           }
//         });
//
//         if (enemy.hp > 0) {
//           newEnemies.push(enemy);
//         } else {
//           // Ï†Å Ï£ΩÏùå - XP Ïò§Î∏å ÏÉùÏÑ±
//           setXpOrbs((prevOrbs) => [
//             ...prevOrbs,
//             createXpOrb(enemy.x, enemy.y, enemy.xp),
//           ]);
//           setScore((prevScore) => prevScore + enemy.xp * 10);
//         }
//       });
//
//       // ÎßûÏùÄ Î∞úÏÇ¨Ï≤¥ Ï†úÍ±∞
//       setProjectiles((prev) =>
//         prev.filter((proj) => !hitProjectiles.has(proj.id)),
//       );
//
//       return newEnemies;
//     });
//
//     // Ï∂©Îèå Í≤ÄÏÇ¨ - ÌîåÎ†àÏù¥Ïñ¥ÏôÄ Ï†Å
//     setPlayer((prev) => {
//       let damage = 0;
//       enemies.forEach((enemy) => {
//         const distance = Math.sqrt(
//           (enemy.x - prev.x) ** 2 + (enemy.y - prev.y) ** 2,
//         );
//         if (distance < PLAYER_SIZE + ENEMY_SIZE) {
//           damage += 10;
//         }
//       });
//
//       const newHp = Math.max(0, prev.hp - damage / prev.stats.armor);
//       if (newHp <= 0) {
//         setGameState("gameover");
//       }
//
//       return { ...prev, hp: newHp };
//     });
//
//     // XP Ïò§Î∏å ÏàòÏßë
//     setPlayer((prev) => {
//       let xpGained = 0;
//
//       setXpOrbs((prevOrbs) =>
//         prevOrbs.filter((orb) => {
//           const distance = Math.sqrt(
//             (orb.x - prev.x) ** 2 + (orb.y - prev.y) ** 2,
//           );
//
//           if (distance < PLAYER_SIZE + XP_ORB_SIZE) {
//             xpGained += orb.xp;
//             return false;
//           }
//
//           orb.life--;
//           return orb.life > 0;
//         }),
//       );
//
//       if (xpGained > 0) {
//         const newXp = prev.xp + xpGained;
//         if (newXp >= prev.xpToNext) {
//           // Î†àÎ≤®ÏóÖ
//           const newLevel = prev.level + 1;
//           const options = generateLevelUpOptions();
//           setLevelUpOptions(options);
//           setGameState("levelup");
//
//           return {
//             ...prev,
//             xp: newXp - prev.xpToNext,
//             level: newLevel,
//             xpToNext: prev.xpToNext + 50,
//             hp: Math.min(prev.maxHp, prev.hp + 20), // Î†àÎ≤®ÏóÖÏãú Ï≤¥Î†• ÌöåÎ≥µ
//           };
//         }
//
//         return { ...prev, xp: newXp };
//       }
//
//       return prev;
//     });
//
//     // Í≤åÏûÑ ÏãúÍ∞Ñ Ï≤¥ÌÅ¨ (30Î∂Ñ = 108000 ÌîÑÎ†àÏûÑ)
//     if (gameTime >= 108000) {
//       setGameState("gameover");
//     }
//   }, [
//     gameState,
//     gameTime,
//     keys,
//     player.x,
//     player.y,
//     enemies,
//     projectiles,
//     spawnEnemy,
//     createProjectile,
//     createXpOrb,
//     generateLevelUpOptions,
//   ]);
//
//   // Í≤åÏûÑ Î£®ÌîÑ
//   useEffect(() => {
//     if (gameState === "playing") {
//       gameLoopRef.current = setInterval(updateGame, 16); // 60 FPS
//     } else {
//       if (gameLoopRef.current) {
//         clearInterval(gameLoopRef.current);
//       }
//     }
//
//     return () => {
//       if (gameLoopRef.current) {
//         clearInterval(gameLoopRef.current);
//       }
//     };
//   }, [gameState, updateGame]);
//
//   // Ïä§ÌÅ¨Î°§ Î∞©ÏßÄ
//   useEffect(() => {
//     if (
//       gameState === "playing" ||
//       gameState === "paused" ||
//       gameState === "levelup"
//     ) {
//       document.body.style.overflow = "hidden";
//     } else {
//       document.body.style.overflow = "auto";
//     }
//
//     return () => {
//       document.body.style.overflow = "auto";
//     };
//   }, [gameState]);
//
//   // Ï∫îÎ≤ÑÏä§ Î†åÎçîÎßÅ
//   useEffect(() => {
//     const canvas = canvasRef.current;
//     if (!canvas) return;
//
//     const ctx = canvas.getContext("2d");
//     ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
//
//     // Î∞∞Í≤Ω Í∑∏ÎùºÎîîÏñ∏Ìä∏
//     const gradient = ctx.createLinearGradient(0, 0, GAME_WIDTH, GAME_HEIGHT);
//     gradient.addColorStop(0, "#1a1a2e");
//     gradient.addColorStop(0.5, "#16213e");
//     gradient.addColorStop(1, "#0f0f23");
//     ctx.fillStyle = gradient;
//     ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
//
//     // Í≤©Ïûê Ìå®ÌÑ¥
//     ctx.strokeStyle = "#333";
//     ctx.lineWidth = 1;
//     for (let x = 0; x < GAME_WIDTH; x += 50) {
//       ctx.beginPath();
//       ctx.moveTo(x, 0);
//       ctx.lineTo(x, GAME_HEIGHT);
//       ctx.stroke();
//     }
//     for (let y = 0; y < GAME_HEIGHT; y += 50) {
//       ctx.beginPath();
//       ctx.moveTo(0, y);
//       ctx.lineTo(GAME_WIDTH, y);
//       ctx.stroke();
//     }
//
//     if (
//       gameState === "playing" ||
//       gameState === "paused" ||
//       gameState === "levelup"
//     ) {
//       // XP Ïò§Î∏å Î†åÎçîÎßÅ
//       xpOrbs.forEach((orb) => {
//         ctx.fillStyle = "#ffd700";
//         ctx.beginPath();
//         ctx.arc(orb.x, orb.y, XP_ORB_SIZE, 0, 2 * Math.PI);
//         ctx.fill();
//
//         ctx.fillStyle = "#fff";
//         ctx.beginPath();
//         ctx.arc(orb.x, orb.y, XP_ORB_SIZE * 0.6, 0, 2 * Math.PI);
//         ctx.fill();
//       });
//
//       // Ï†Å Î†åÎçîÎßÅ
//       enemies.forEach((enemy) => {
//         ctx.fillStyle = enemy.color;
//         ctx.beginPath();
//         ctx.arc(enemy.x, enemy.y, ENEMY_SIZE, 0, 2 * Math.PI);
//         ctx.fill();
//
//         // Ï†Å ÏïÑÏù¥ÏΩò
//         ctx.font = "16px Arial";
//         ctx.textAlign = "center";
//         ctx.fillText(enemy.icon, enemy.x, enemy.y + 5);
//
//         // HP Î∞î
//         if (enemy.hp < enemy.maxHp) {
//           ctx.fillStyle = "#333";
//           ctx.fillRect(
//             enemy.x - ENEMY_SIZE,
//             enemy.y - ENEMY_SIZE - 8,
//             ENEMY_SIZE * 2,
//             4,
//           );
//           ctx.fillStyle = "#ff4757";
//           ctx.fillRect(
//             enemy.x - ENEMY_SIZE,
//             enemy.y - ENEMY_SIZE - 8,
//             ENEMY_SIZE * 2 * (enemy.hp / enemy.maxHp),
//             4,
//           );
//         }
//       });
//
//       // Î∞úÏÇ¨Ï≤¥ Î†åÎçîÎßÅ
//       projectiles.forEach((proj) => {
//         ctx.font = "12px Arial";
//         ctx.textAlign = "center";
//         ctx.fillText(proj.icon, proj.x, proj.y + 4);
//       });
//
//       // ÌîåÎ†àÏù¥Ïñ¥ Î†åÎçîÎßÅ
//       if (selectedCharacter) {
//         ctx.fillStyle = selectedCharacter.color;
//         ctx.beginPath();
//         ctx.arc(player.x, player.y, PLAYER_SIZE, 0, 2 * Math.PI);
//         ctx.fill();
//
//         ctx.fillStyle = "#fff";
//         ctx.beginPath();
//         ctx.arc(player.x, player.y, PLAYER_SIZE * 0.7, 0, 2 * Math.PI);
//         ctx.fill();
//
//         // ÌîåÎ†àÏù¥Ïñ¥ ÏïÑÏù¥ÏΩò
//         ctx.fillStyle = selectedCharacter.color;
//         ctx.font = "20px Arial";
//         ctx.textAlign = "center";
//         const IconComponent = selectedCharacter.icon;
//         ctx.fillText("üéØ", player.x, player.y + 6);
//       }
//     }
//   }, [gameState, player, enemies, projectiles, xpOrbs, selectedCharacter]);
//
//   const formatTime = (frames) => {
//     const totalSeconds = Math.floor(frames / 60);
//     const minutes = Math.floor(totalSeconds / 60);
//     const seconds = totalSeconds % 60;
//     return `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
//   };
//
//   const resetGame = () => {
//     setPlayer({
//       x: GAME_WIDTH / 2,
//       y: GAME_HEIGHT / 2,
//       hp: selectedCharacter?.stats.hp || 100,
//       maxHp: selectedCharacter?.stats.hp || 100,
//       xp: 0,
//       level: 1,
//       xpToNext: 100,
//       weapons: [],
//       passives: [],
//       stats: selectedCharacter
//         ? { ...selectedCharacter.stats }
//         : { speed: 2, damage: 1, armor: 1, maxHp: 100, cooldown: 1 },
//     });
//     setEnemies([]);
//     setProjectiles([]);
//     setXpOrbs([]);
//     setGameTime(0);
//     setScore(0);
//     setGameState("playing");
//   };
//
//   return (
//     <div className="flex flex-col items-center min-h-screen bg-gray-900 text-white p-4">
//       <h1 className="text-4xl font-bold mb-4 text-red-500">
//         üßõ Vampire Survivors
//       </h1>
//
//       {gameState === "character-select" && (
//         <div className="text-center">
//           <h2 className="text-2xl mb-6">Ï∫êÎ¶≠ÌÑ∞Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</h2>
//           <div className="grid grid-cols-3 gap-4">
//             {characters.map((char) => {
//               const IconComponent = char.icon;
//               return (
//                 <button
//                   key={char.id}
//                   onClick={() => selectCharacter(char)}
//                   className="p-6 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors border-2 border-transparent hover:border-red-500"
//                 >
//                   <IconComponent
//                     className="w-12 h-12 mx-auto mb-2"
//                     style={{ color: char.color }}
//                   />
//                   <h3 className="text-xl font-bold mb-2">{char.name}</h3>
//                   <div className="text-sm text-gray-400">
//                     <p>Ï≤¥Î†•: {char.stats.hp}</p>
//                     <p>ÏÜçÎèÑ: {char.stats.speed}</p>
//                     <p>Í≥µÍ≤©Î†•: {char.stats.damage}x</p>
//                     <p>Î∞©Ïñ¥Î†•: {char.stats.armor}x</p>
//                   </div>
//                 </button>
//               );
//             })}
//           </div>
//         </div>
//       )}
//
//       {(gameState === "playing" ||
//         gameState === "paused" ||
//         gameState === "levelup") && (
//         <>
//           {/* UI Ï†ïÎ≥¥ */}
//           <div className="flex justify-between w-full max-w-4xl mb-4">
//             <div className="flex items-center gap-4">
//               <div className="flex items-center gap-2">
//                 <Heart className="w-5 h-5 text-red-500" />
//                 <div className="w-32 bg-gray-700 rounded-full h-4">
//                   <div
//                     className="bg-red-500 h-4 rounded-full"
//                     style={{ width: `${(player.hp / player.maxHp) * 100}%` }}
//                   />
//                 </div>
//                 <span>
//                   {Math.round(player.hp)}/{player.maxHp}
//                 </span>
//               </div>
//
//               <div className="flex items-center gap-2">
//                 <Star className="w-5 h-5 text-blue-500" />
//                 <div className="w-32 bg-gray-700 rounded-full h-4">
//                   <div
//                     className="bg-blue-500 h-4 rounded-full"
//                     style={{ width: `${(player.xp / player.xpToNext) * 100}%` }}
//                   />
//                 </div>
//                 <span>Lv.{player.level}</span>
//               </div>
//             </div>
//
//             <div className="flex items-center gap-4">
//               <span>ÏãúÍ∞Ñ: {formatTime(gameTime)}</span>
//               <span>Ï†êÏàò: {score.toLocaleString()}</span>
//               <button
//                 onClick={() =>
//                   setGameState(gameState === "paused" ? "playing" : "paused")
//                 }
//                 className="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded"
//               >
//                 {gameState === "paused" ? "Í≥ÑÏÜç" : "ÏùºÏãúÏ†ïÏßÄ"}
//               </button>
//             </div>
//           </div>
//
//           {/* Í≤åÏûÑ Ï∫îÎ≤ÑÏä§ */}
//           <canvas
//             ref={canvasRef}
//             width={GAME_WIDTH}
//             height={GAME_HEIGHT}
//             className="border-2 border-gray-600 rounded-lg bg-gray-800"
//           />
//
//           {/* Î¨¥Í∏∞ Î∞è Ìå®ÏãúÎ∏å Ï†ïÎ≥¥ */}
//           <div className="flex gap-4 mt-4 w-full max-w-4xl">
//             <div className="flex-1">
//               <h3 className="text-lg font-bold mb-2">Î¨¥Í∏∞</h3>
//               <div className="grid grid-cols-3 gap-2">
//                 {player.weapons.map((weapon, index) => (
//                   <div
//                     key={index}
//                     className="bg-gray-800 p-2 rounded text-center"
//                   >
//                     <div className="text-2xl mb-1">{weapon.icon}</div>
//                     <div className="text-sm">{weapon.name}</div>
//                     <div className="text-xs text-gray-400">
//                       Lv.{weapon.level}
//                     </div>
//                   </div>
//                 ))}
//               </div>
//             </div>
//
//             <div className="flex-1">
//               <h3 className="text-lg font-bold mb-2">Ìå®ÏãúÎ∏å</h3>
//               <div className="grid grid-cols-3 gap-2">
//                 {player.passives.map((passive, index) => (
//                   <div
//                     key={index}
//                     className="bg-gray-800 p-2 rounded text-center"
//                   >
//                     <div className="text-2xl mb-1">{passive.icon}</div>
//                     <div className="text-sm">{passive.name}</div>
//                     <div className="text-xs text-gray-400">
//                       Lv.{passive.level}
//                     </div>
//                   </div>
//                 ))}
//               </div>
//             </div>
//           </div>
//
//           {/* Î™®Î∞îÏùº Ï°∞Ïûë Î≤ÑÌäº */}
//           <div className="fixed bottom-4 left-4 md:hidden">
//             <div className="grid grid-cols-3 gap-2 w-32 h-32">
//               <div></div>
//               <button
//                 onTouchStart={() =>
//                   setKeys((prev) => ({ ...prev, ArrowUp: true }))
//                 }
//                 onTouchEnd={() =>
//                   setKeys((prev) => ({ ...prev, ArrowUp: false }))
//                 }
//                 className="bg-gray-700 rounded p-2"
//               >
//                 ‚Üë
//               </button>
//               <div></div>
//               <button
//                 onTouchStart={() =>
//                   setKeys((prev) => ({ ...prev, ArrowLeft: true }))
//                 }
//                 onTouchEnd={() =>
//                   setKeys((prev) => ({ ...prev, ArrowLeft: false }))
//                 }
//                 className="bg-gray-700 rounded p-2"
//               >
//                 ‚Üê
//               </button>
//               <div></div>
//               <button
//                 onTouchStart={() =>
//                   setKeys((prev) => ({ ...prev, ArrowRight: true }))
//                 }
//                 onTouchEnd={() =>
//                   setKeys((prev) => ({ ...prev, ArrowRight: false }))
//                 }
//                 className="bg-gray-700 rounded p-2"
//               >
//                 ‚Üí
//               </button>
//               <div></div>
//               <button
//                 onTouchStart={() =>
//                   setKeys((prev) => ({ ...prev, ArrowDown: true }))
//                 }
//                 onTouchEnd={() =>
//                   setKeys((prev) => ({ ...prev, ArrowDown: false }))
//                 }
//                 className="bg-gray-700 rounded p-2"
//               >
//                 ‚Üì
//               </button>
//               <div></div>
//             </div>
//           </div>
//
//           {gameState === "paused" && (
//             <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center">
//               <div className="bg-gray-800 p-8 rounded-lg text-center">
//                 <h2 className="text-3xl font-bold mb-4">Í≤åÏûÑ ÏùºÏãúÏ†ïÏßÄ</h2>
//                 <div className="space-y-4">
//                   <button
//                     onClick={() => setGameState("playing")}
//                     className="block w-full px-6 py-3 bg-green-600 hover:bg-green-500 rounded-lg font-bold"
//                   >
//                     Í≤åÏûÑ Í≥ÑÏÜç
//                   </button>
//                   <button
//                     onClick={() => setGameState("character-select")}
//                     className="block w-full px-6 py-3 bg-gray-600 hover:bg-gray-500 rounded-lg font-bold"
//                   >
//                     Ï∫êÎ¶≠ÌÑ∞ ÏÑ†ÌÉùÏúºÎ°ú
//                   </button>
//                 </div>
//                 <p className="text-sm text-gray-400 mt-4">
//                   Ï°∞ÏûëÎ≤ï: Î∞©Ìñ•ÌÇ§ ÎòêÎäî WASDÎ°ú Ïù¥Îèô, Ïä§ÌéòÏù¥Ïä§Î∞îÎ°ú ÏùºÏãúÏ†ïÏßÄ
//                 </p>
//               </div>
//             </div>
//           )}
//         </>
//       )}
//
//       {gameState === "levelup" && (
//         <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center">
//           <div className="bg-gray-800 p-8 rounded-lg">
//             <h2 className="text-3xl font-bold mb-6 text-center text-yellow-400">
//               <Crown className="w-8 h-8 inline-block mr-2" />
//               Î†àÎ≤® ÏóÖ! (Lv.{player.level})
//             </h2>
//             <p className="text-center mb-6 text-gray-300">
//               Í∞ïÌôîÌï† Ìï≠Î™©ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî
//             </p>
//
//             <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
//               {levelUpOptions.map((option, index) => (
//                 <button
//                   key={index}
//                   onClick={() => selectLevelUpOption(option)}
//                   className="p-6 bg-gray-700 hover:bg-gray-600 rounded-lg border-2 border-transparent hover:border-yellow-400 transition-colors"
//                 >
//                   {option.type === "weapon" && (
//                     <>
//                       <div className="text-4xl mb-2">{option.weapon.icon}</div>
//                       <h3 className="text-xl font-bold mb-2 text-blue-400">
//                         {option.weapon.name}
//                       </h3>
//                       <p className="text-sm text-gray-300">ÏÉàÎ°úÏö¥ Î¨¥Í∏∞</p>
//                       <p className="text-xs text-gray-400">
//                         ÌîºÌï¥: {option.weapon.damage} | Ïø®Îã§Ïö¥:{" "}
//                         {option.weapon.cooldown}ms
//                       </p>
//                     </>
//                   )}
//
//                   {option.type === "upgrade" && (
//                     <>
//                       <div className="text-4xl mb-2">{option.weapon.icon}</div>
//                       <h3 className="text-xl font-bold mb-2 text-green-400">
//                         {option.weapon.name}
//                       </h3>
//                       <p className="text-sm text-gray-300">
//                         Î†àÎ≤® ÏóÖ (Lv.{option.weapon.level} ‚Üí{" "}
//                         {option.weapon.level + 1})
//                       </p>
//                       <p className="text-xs text-gray-400">
//                         ÌîºÌï¥ÎüâÍ≥º Ìö®Í≥º Ï¶ùÍ∞Ä
//                       </p>
//                     </>
//                   )}
//
//                   {option.type === "evolution" && (
//                     <>
//                       <div className="text-4xl mb-2">{option.weapon.icon}</div>
//                       <h3 className="text-xl font-bold mb-2 text-purple-400">
//                         {option.weapon.name}
//                       </h3>
//                       <p className="text-sm text-gray-300">ÏßÑÌôî!</p>
//                       <p className="text-xs text-gray-400">
//                         {option.baseWeapon.name}ÏóêÏÑú ÏßÑÌôî
//                       </p>
//                     </>
//                   )}
//
//                   {option.type === "passive" && (
//                     <>
//                       <div className="text-4xl mb-2">{option.passive.icon}</div>
//                       <h3 className="text-xl font-bold mb-2 text-orange-400">
//                         {option.passive.name}
//                       </h3>
//                       <p className="text-sm text-gray-300">Ìå®ÏãúÎ∏å Í∞ïÌôî</p>
//                       <p className="text-xs text-gray-400">
//                         {option.passive.effect} +{option.passive.value}
//                       </p>
//                     </>
//                   )}
//                 </button>
//               ))}
//             </div>
//           </div>
//         </div>
//       )}
//
//       {gameState === "gameover" && (
//         <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center">
//           <div className="bg-gray-800 p-8 rounded-lg text-center">
//             <Skull className="w-16 h-16 mx-auto mb-4 text-red-500" />
//             <h2 className="text-4xl font-bold mb-4 text-red-500">Í≤åÏûÑ Ïò§Î≤Ñ</h2>
//
//             <div className="mb-6 space-y-2">
//               <p className="text-2xl">ÏÉùÏ°¥ ÏãúÍ∞Ñ: {formatTime(gameTime)}</p>
//               <p className="text-xl">ÏµúÏ¢Ö Ï†êÏàò: {score.toLocaleString()}</p>
//               <p className="text-lg">ÎèÑÎã¨ Î†àÎ≤®: {player.level}</p>
//               <p className="text-md text-gray-400">
//                 Ï≤òÏπòÌïú Ï†Å: {Math.floor(score / 30)}
//               </p>
//             </div>
//
//             <div className="space-y-4">
//               <button
//                 onClick={resetGame}
//                 className="block w-full px-6 py-3 bg-red-600 hover:bg-red-500 rounded-lg font-bold"
//               >
//                 Îã§Ïãú ÎèÑÏ†Ñ
//               </button>
//               <button
//                 onClick={() => setGameState("character-select")}
//                 className="block w-full px-6 py-3 bg-gray-600 hover:bg-gray-500 rounded-lg font-bold"
//               >
//                 Ï∫êÎ¶≠ÌÑ∞ ÏÑ†ÌÉù
//               </button>
//             </div>
//           </div>
//         </div>
//       )}
//
//       {/* Í≤åÏûÑ ÏÑ§Î™Ö */}
//       {gameState === "character-select" && (
//         <div className="mt-8 max-w-2xl text-center text-gray-400">
//           <h3 className="text-lg font-bold mb-2">Í≤åÏûÑ Î∞©Î≤ï</h3>
//           <p className="mb-4">
//             30Î∂Ñ ÎèôÏïà ÏÇ¥ÏïÑÎÇ®ÏúºÏÑ∏Ïöî! Ï†ÅÏùÑ Ï≤òÏπòÌïòÏó¨ Í≤ΩÌóòÏπòÎ•º ÏñªÍ≥† Î†àÎ≤®ÏóÖÌïòÏó¨ Îçî
//             Í∞ïÌï¥ÏßÄÏÑ∏Ïöî.
//           </p>
//           <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
//             <div>
//               <h4 className="font-bold text-white mb-2">Ï°∞ÏûëÎ≤ï</h4>
//               <ul className="space-y-1">
//                 <li>Ïù¥Îèô: Î∞©Ìñ•ÌÇ§ ÎòêÎäî WASD</li>
//                 <li>ÏùºÏãúÏ†ïÏßÄ: Ïä§ÌéòÏù¥Ïä§Î∞î</li>
//                 <li>Í≥µÍ≤©: ÏûêÎèô (Í∞ÄÏû• Í∞ÄÍπåÏö¥ Ï†Å)</li>
//               </ul>
//             </div>
//             <div>
//               <h4 className="font-bold text-white mb-2">ÌåÅ</h4>
//               <ul className="space-y-1">
//                 <li>Í≤ΩÌóòÏπò Ïò§Î∏åÎ•º ÏàòÏßëÌïòÏó¨ Î†àÎ≤®ÏóÖ</li>
//                 <li>Î¨¥Í∏∞Îäî Î†àÎ≤® 3ÏóêÏÑú ÏßÑÌôî Í∞ÄÎä•</li>
//                 <li>Ìå®ÏãúÎ∏åÎ°ú Ï∫êÎ¶≠ÌÑ∞ Í∞ïÌôî</li>
//                 <li>Ï†ÅÏù¥ ÏãúÍ∞ÑÏù¥ ÏßÄÎÇ†ÏàòÎ°ù Í∞ïÌï¥ÏßëÎãàÎã§</li>
//               </ul>
//             </div>
//           </div>
//         </div>
//       )}
//     </div>
//   );
// }
